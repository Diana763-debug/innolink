<!DOCTYPE html>
<html lang="ms">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Butiran Idea</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">ðŸ’¡ InnoLink</div>
      <div class="toplinks">
        <a href="index.html">Home</a>
        <a href="upload.html">Muat Naik</a>
        <a href="profile.html">Profil</a>
      </div>
    </div>

    <div id="ideaWrap" class="card" style="max-width:840px;margin:auto"></div>

    <div class="footer">Â© InnoLink</div>
  </div>

  <script src="app-data.js"></script>
  <script>
    function getQuery(name){ const params = new URLSearchParams(location.search); return params.get(name); }
    const id = getQuery('id');
    const wrap = document.getElementById('ideaWrap');

    const userIdeas = JSON.parse(localStorage.getItem('userIdeas')||'[]');
    const allIdeas = userIdeas.concat(DATA.ideas);
    const idea = allIdeas.find(i=>String(i.id)===String(id)) || allIdeas[0];

    function render(){
      wrap.innerHTML = `
        <div style="display:flex;flex-direction:column;gap:12px">
          <div>
            <h2 style="margin:0">${idea.title}</h2>
            <p style="color:var(--muted)">${idea.desc}</p>
          </div>

          <div class="pdf-preview">${idea.pdfName || 'PDF Contoh'}</div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
            <div style="font-weight:700;font-size:18px">RM ${idea.price}</div>
            <div style="display:flex;gap:10px">
              <button class="btn" id="buyBtn">Beli Sekarang</button>
              <a class="btn ghost" href="${idea.pdfUrl}" download>Muat Turun PDF</a>
            </div>
          </div>

          <div class="comments">
            <h4>Komen</h4>
            <div id="commentsList"></div>
            <textarea id="newComment" placeholder="Tulis komen anda..." style="width:100%;margin-top:8px;padding:8px;border-radius:8px;border:1px solid #eef2ff"></textarea>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="sendC">Hantar Komen</button>
              <button class="btn ghost" id="refreshC">Segarkan</button>
            </div>
          </div>
        </div>
      `;

      document.getElementById('buyBtn').onclick = ()=> {
        location.href = `qr.html?amount=${idea.price}&title=${encodeURIComponent(idea.title)}`;
      };

      document.getElementById('sendC').onclick = ()=> {
        const text = document.getElementById('newComment').value.trim();
        if(!text) return alert('Sila taip komen terlebih dahulu.');
        const key = 'comments_'+idea.id;
        const arr = JSON.parse(localStorage.getItem(key) || '[]');
        arr.unshift({text, at: new Date().toLocaleString()});
        localStorage.setItem(key, JSON.stringify(arr));
        document.getElementById('newComment').value='';
        loadComments();
      };
      document.getElementById('refreshC').onclick = loadComments;
      loadComments();
    }

    function loadComments(){
      const key = 'comments_'+idea.id;
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      const list = document.getElementById('commentsList');
      list.innerHTML = '';
      if(arr.length===0) list.innerHTML = '<div style="color:var(--muted)">Tiada komen lagi.</div>';
      arr.forEach(c=>{
        const d = document.createElement('div');
        d.className='comment';
        d.innerHTML = `<div style="font-size:13px;color:var(--muted)">${c.at}</div><div style="margin-top:6px">${c.text}</div>`;
        list.appendChild(d);
      });
    }

    render();
  </script>
</body>
</html>

